<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aspect importance function examples • DALEXtra</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Aspect importance function examples">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">DALEXtra</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.2.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_aspect_importance.html">Aspect importance function examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/DALEXtra">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Aspect importance function examples</h1>
                        <h4 class="author">Katarzyna Pękala</h4>
            
            <h4 class="date">2019-11-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/DALEXtra/blob/master/vignettes/vignette_aspect_importance.Rmd"><code>vignettes/vignette_aspect_importance.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_aspect_importance.Rmd</code></div>

    </div>

    
    
<div id="data-and-logistic-regression-model-for-titanic-survival" class="section level1">
<h1 class="hasAnchor">
<a href="#data-and-logistic-regression-model-for-titanic-survival" class="anchor"></a>Data and logistic regression model for Titanic survival</h1>
<p>Vignette presents the aspect_importance() function on the datasets: <code>titanic_imputed</code> and <code>apartments</code> (both are available in the <code>DALEX</code> package). At the beginning, we download <code>titanic_imputed</code> dataset and build logistic regression model.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"DALEX"</span>)</a>
<a class="sourceLine" id="cb1-2" title="2">titanic &lt;-<span class="st"> </span>titanic_imputed</a>
<a class="sourceLine" id="cb1-3" title="3">titanic<span class="op">$</span>country &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb1-4" title="4">titanic_without_target &lt;-<span class="st"> </span>titanic[,<span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(titanic)<span class="op">!=</span><span class="st">"survived"</span>]</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(titanic)</a></code></pre></div>
<pre><code>#&gt;   gender age class    embarked  fare sibsp parch survived
#&gt; 1   male  42   3rd Southampton  7.11     0     0        0
#&gt; 2   male  13   3rd Southampton 20.05     0     2        0
#&gt; 3   male  16   3rd Southampton 20.05     1     1        0
#&gt; 4 female  39   3rd Southampton 20.05     1     1        1
#&gt; 5 female  16   3rd Southampton  7.13     0     0        1
#&gt; 6   male  25   3rd Southampton  7.13     0     0        1</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">model_titanic_glm &lt;-</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(survived <span class="op">==</span><span class="st"> "yes"</span> <span class="op">~</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>sibsp <span class="op">+</span><span class="st"> </span>parch <span class="op">+</span><span class="st"> </span>fare <span class="op">+</span><span class="st"> </span>embarked,</a>
<a class="sourceLine" id="cb3-3" title="3">      titanic,</a>
<a class="sourceLine" id="cb3-4" title="4">      <span class="dt">family =</span> <span class="st">"binomial"</span>)</a></code></pre></div>
</div>
<div id="preparing-additional-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#preparing-additional-parameters" class="anchor"></a>Preparing additional parameters</h1>
<p>Before using aspect_importance() we need to:</p>
<ul>
<li>group features of the dataset into aspects,</li>
<li>choose observation for which we want to explain aspects’ importance.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">aspects_titanic &lt;-</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="dt">wealth =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"class"</span>, <span class="st">"fare"</span>),</a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sibsp"</span>, <span class="st">"parch"</span>),</a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="dt">personal =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age"</span>, <span class="st">"gender"</span>),</a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="dt">embarked =</span> <span class="st">"embarked"</span></a>
<a class="sourceLine" id="cb4-7" title="7">  )</a>
<a class="sourceLine" id="cb4-8" title="8">passenger &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="dt">class =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(</a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="st">"3rd"</span>,</a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="dt">levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1st"</span>, <span class="st">"2nd"</span>, <span class="st">"3rd"</span>, <span class="st">"deck crew"</span>, <span class="st">"engineering crew"</span>, <span class="st">"restaurant staff"</span>, <span class="st">"victualling crew"</span>)),</a>
<a class="sourceLine" id="cb4-12" title="12">  <span class="dt">gender =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="st">"male"</span>, <span class="dt">levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"female"</span>, <span class="st">"male"</span>)),</a>
<a class="sourceLine" id="cb4-13" title="13">  <span class="dt">age =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb4-14" title="14">  <span class="dt">sibsp =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb4-15" title="15">  <span class="dt">parch =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb4-16" title="16">  <span class="dt">fare =</span> <span class="dv">18</span>,</a>
<a class="sourceLine" id="cb4-17" title="17">  <span class="dt">embarked =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(</a>
<a class="sourceLine" id="cb4-18" title="18">    <span class="st">"Southampton"</span>,</a>
<a class="sourceLine" id="cb4-19" title="19">    <span class="dt">levels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Belfast"</span>, <span class="st">"Cherbourg"</span>, <span class="st">"Queenstown"</span>, <span class="st">"Southampton"</span>)</a>
<a class="sourceLine" id="cb4-20" title="20">  )</a>
<a class="sourceLine" id="cb4-21" title="21">)</a>
<a class="sourceLine" id="cb4-22" title="22"></a>
<a class="sourceLine" id="cb4-23" title="23">passenger</a></code></pre></div>
<pre><code>#&gt;   class gender age sibsp parch fare    embarked
#&gt; 1   3rd   male   8     0     0   18 Southampton</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(model_titanic_glm, passenger, <span class="dt">type =</span> <span class="st">"response"</span>)</a></code></pre></div>
<pre><code>#&gt;            1 
#&gt; 2.900701e-12</code></pre>
</div>
<div id="calculating-aspect-importance-logistic-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-aspect-importance-logistic-regression" class="anchor"></a>Calculating aspect importance (logistic regression)</h1>
<p>Now we can call aspect_importance() function and see that features included in <code>wealth</code> (that is <code>class</code> and <code>fare</code>) have the biggest contribution on survival prediction for the passenger. That contribution is of negative type. Rest of the aspects have significantly smaller influence. However, in case of <code>family</code> and <code>personal</code>, it’s a positive type of influence.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"DALEXtra"</span>)</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4">titanic_glm_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(model_titanic_glm, titanic, predict, passenger, aspects_titanic, <span class="dt">N =</span> <span class="dv">1000</span>, <span class="dt">label =</span> <span class="st">"logistic regression"</span>)</a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6">titanic_glm_ai</a></code></pre></div>
<pre><code>#&gt;    aspects importance     features
#&gt; 2   wealth  1.241e-13  class, fare
#&gt; 4 personal -8.986e-14  age, gender
#&gt; 5 embarked  1.952e-14     embarked
#&gt; 3   family  8.811e-15 sibsp, parch</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(titanic_glm_ai) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Aspect importance for the selected passenger"</span>)</a></code></pre></div>
<p><img src="vignette_aspect_importance_files/figure-html/Calculating%20aspect%20importance%20(logistic%20regression)-1.png" width="700"></p>
</div>
<div id="calculating-aspect-importance-with-explainer" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-aspect-importance-with-explainer" class="anchor"></a>Calculating aspect importance with explainer</h1>
<p>Aspect_importance() could be also called using <code>DALEX</code> explainer as we show below.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">explain_titanic_glm &lt;-<span class="st"> </span><span class="kw">explain</span>(model_titanic_glm, </a>
<a class="sourceLine" id="cb11-2" title="2">                      <span class="dt">data =</span> titanic_without_target,</a>
<a class="sourceLine" id="cb11-3" title="3">                      <span class="dt">y =</span> titanic<span class="op">$</span>survived <span class="op">==</span><span class="st"> "yes"</span>, </a>
<a class="sourceLine" id="cb11-4" title="4">                      <span class="dt">predict_function =</span> predict,</a>
<a class="sourceLine" id="cb11-5" title="5">                      <span class="dt">label =</span> <span class="st">"Logistic Regression"</span>, </a>
<a class="sourceLine" id="cb11-6" title="6">                      <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">titanic_glm_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(explain_titanic_glm, passenger, aspects_titanic, <span class="dt">N =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb11-9" title="9">titanic_glm_ai</a></code></pre></div>
<pre><code>#&gt;    aspects importance     features
#&gt; 2   wealth  1.241e-13  class, fare
#&gt; 4 personal -8.986e-14  age, gender
#&gt; 5 embarked  1.952e-14     embarked
#&gt; 3   family  8.811e-15 sibsp, parch</code></pre>
</div>
<div id="random-forest-model-for-titanic-survival" class="section level1">
<h1 class="hasAnchor">
<a href="#random-forest-model-for-titanic-survival" class="anchor"></a>Random forest model for Titanic survival</h1>
<p>Now, we prepare random forest model for the <code>titanic</code> dataset.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"randomForest"</span>)</a>
<a class="sourceLine" id="cb13-2" title="2">model_titanic_rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(<span class="kw"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(survived) <span class="op">==</span><span class="st"> "yes"</span> <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>embarked <span class="op">+</span><span class="st"> </span>fare <span class="op">+</span><span class="st"> </span>sibsp <span class="op">+</span><span class="st"> </span>parch,  <span class="dt">data =</span> titanic)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(model_titanic_rf, passenger)</a></code></pre></div>
<pre><code>#&gt; 1 
#&gt; 0</code></pre>
</div>
<div id="calculating-aspect-importance-random-forest" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-aspect-importance-random-forest" class="anchor"></a>Calculating aspect importance (random forest)</h1>
<p>After calling aspect_importance() we can see why the survival prediction for the passenger in random forest model was much higher (0.5) than in logistic regression case (0.18).</p>
<p>In this example <code>personal</code> features (<code>age</code> and <code>gender</code>) have the biggest positive influence. Aspects <code>wealth</code> (<code>class</code>, <code>fare</code>) and <code>embarked</code> have both much smaller contribution and those are negative ones. Aspect <code>family</code> has very small influence on the prediction.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">titanic_rf_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(model_titanic_rf, titanic, predict, passenger, aspects_titanic, <span class="dt">N =</span> <span class="dv">1000</span>, <span class="dt">label =</span> <span class="st">"random forest"</span>)</a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3">titanic_rf_ai</a></code></pre></div>
<pre><code>#&gt;    aspects importance     features
#&gt; 2   wealth          0  class, fare
#&gt; 3   family          0 sibsp, parch
#&gt; 4 personal          0  age, gender
#&gt; 5 embarked          0     embarked</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(titanic_rf_ai) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Aspect importance for the selected passenger"</span>)</a></code></pre></div>
<p><img src="vignette_aspect_importance_files/figure-html/Calculating%20aspect%20importance%20(random%20forest)-1.png" width="700"></p>
</div>
<div id="using-lasso-in-aspect_importance-function" class="section level1">
<h1 class="hasAnchor">
<a href="#using-lasso-in-aspect_importance-function" class="anchor"></a>Using lasso in aspect_importance() function</h1>
<p>Function aspect_importance() can calculate coefficients (that is aspects’ importance) by using either linear regression or lasso regression. Using lasso, we can control how many nonzero coefficients (nonzero aspects importance values) are present in the final explanation.</p>
<p>To use aspect_importance() with lasso, we have to provide <code>n_var</code> parameter, which declares how many aspects importance values we would like to get in aspect_importance() results.</p>
<p>For this example, we use <code>titanic_imputed</code> dataset again and random forest model. With the help of lasso technique, we would like to check the importance of variables’ aspects, while controlling that one of them should be equal to 0. Therefore we call aspect_importance() with <code>n_var</code> parameter set to 3.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">titanic_rf_ai_lasso &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(model_titanic_rf, titanic, predict, passenger, aspects_titanic, <span class="dt">N =</span> <span class="dv">1000</span>, <span class="dt">n_var =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb18-2" title="2">titanic_rf_ai_lasso</a></code></pre></div>
</div>
<div id="automated-grouping-features-into-aspects" class="section level1">
<h1 class="hasAnchor">
<a href="#automated-grouping-features-into-aspects" class="anchor"></a>Automated grouping features into aspects</h1>
<p>In examples described above, we had to manually group features into aspects. On <code>apartments</code> dataset, we will test the function that automatically groups features for us (grouping is based on the features correlation). Function only works on numeric variables.</p>
<p>We import <code>apartments</code> from <code>DALEX</code> package and choose columns with numeric features. Then we fit linear model to the data and choose observation to be explained. Target variable is <code>m2.price</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DALEX)</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"apartments"</span>)</a>
<a class="sourceLine" id="cb19-3" title="3">apartments_num &lt;-<span class="st"> </span>apartments[,<span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(apartments, is.numeric))] <span class="co">#excluding non numeric features</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(apartments_num)</a></code></pre></div>
<pre><code>#&gt;   m2.price construction.year surface floor no.rooms
#&gt; 1     5897              1953      25     3        1
#&gt; 2     1818              1992     143     9        5
#&gt; 3     3643              1937      56     1        2
#&gt; 4     3517              1995      93     7        3
#&gt; 5     3013              1992     144     6        5
#&gt; 6     5795              1926      61     6        2</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">apartments_no_target &lt;-<span class="st"> </span>apartments_num[,<span class="op">-</span><span class="dv">1</span>] <span class="co">#excluding target variable</span></a>
<a class="sourceLine" id="cb21-2" title="2">new_observation_apartments &lt;-<span class="st"> </span>apartments_num[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb21-3" title="3">model_apartments &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(m2.price <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> apartments_num)</a></code></pre></div>
<p>We run group_variables() function with cut off level set on 0.6. As a result, we get a list of variables groups (aspects) where absolute value of features’ pairwise correlation is at least at 0.6.</p>
<p>Afterwards, we call aspect_importance() function with parameter <code>show_cor = TRUE</code>, to check how features are grouped into aspects, what is minimal value of pairwise correlation in each group and to check whether any pair of features is negatively correlated (<code>neg</code>) or not (<code>pos</code>).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">aspects_apartments &lt;-<span class="st"> </span><span class="kw"><a href="../reference/group_variables.html">group_variables</a></span>(apartments_no_target, <span class="fl">0.6</span>)</a>
<a class="sourceLine" id="cb22-2" title="2">apartments_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(<span class="dt">x =</span> model_apartments, <span class="dt">data =</span> apartments_no_target, <span class="dt">new_observation =</span> new_observation_apartments, <span class="dt">aspects =</span> aspects_apartments, <span class="dt">N =</span> <span class="dv">500</span>, <span class="dt">show_cor =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb22-3" title="3">apartments_ai</a></code></pre></div>
<pre><code>#&gt;         aspects importance          features   min_cor sign
#&gt; 3 aspect.group2    680.668 surface, no.rooms 0.9174349  pos
#&gt; 4 aspect.group3    235.682             floor        NA     
#&gt; 2 aspect.group1      2.344 construction.year        NA</code></pre>
</div>
<div id="hierarchical-aspects-importance" class="section level1">
<h1 class="hasAnchor">
<a href="#hierarchical-aspects-importance" class="anchor"></a>Hierarchical aspects importance</h1>
<p><code>Triplot</code> is one more tool that allows us to better understand the inner workings a of black box model. It illustrates, in one place:</p>
<ul>
<li>the importance of every single feature,</li>
<li>hierarchical aspects importance (explained below),</li>
<li>order of grouping features into aspects in <code><a href="../reference/group_variables.html">group_variables()</a></code>.</li>
</ul>
<p>Hierarchical aspects importance allows us to check the values of aspects importance for the different levels of variables grouping. Method starts with looking at the aspect importance where every aspect has one, single variable. Afterwards, it iteratively creates bigger aspects by merging the ones with the highest level of absolute correlation into one aspect and calculating it’s contribution to the prediction.</p>
<p>It should be noted that similarly to <code><a href="../reference/group_variables.html">group_variables()</a></code>, <code><a href="../reference/triplot.html">triplot()</a></code> works for the datasets with only numerical variables.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw"><a href="../reference/triplot.html">triplot</a></span>(model_apartments, apartments_no_target, </a>
<a class="sourceLine" id="cb24-2" title="2">        <span class="dt">new_observation =</span> new_observation_apartments, <span class="dt">N =</span> <span class="dv">500</span>, </a>
<a class="sourceLine" id="cb24-3" title="3">        <span class="dt">clust_method =</span> <span class="st">"complete"</span>, <span class="dt">absolute_value =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb24-4" title="4">        <span class="dt">cumulative_max =</span> <span class="ot">FALSE</span>, <span class="dt">add_importance_labels =</span> <span class="ot">FALSE</span>, </a>
<a class="sourceLine" id="cb24-5" title="5">        <span class="dt">abbrev_labels =</span> <span class="dv">15</span>)</a></code></pre></div>
<p><img src="vignette_aspect_importance_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="kw"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span>()</a></code></pre></div>
<pre><code>#&gt; R version 3.6.1 (2019-07-05)
#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)
#&gt; Running under: Windows 10 x64 (build 17763)
#&gt; 
#&gt; Matrix products: default
#&gt; 
#&gt; locale:
#&gt; [1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
#&gt; [3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
#&gt; [5] LC_TIME=Polish_Poland.1250    
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] randomForest_4.6-14 DALEXtra_0.2.0      ggplot2_3.2.1      
#&gt; [4] DALEX_0.4.9        
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.3         compiler_3.6.1     pillar_1.4.2      
#&gt;  [4] ingredients_0.3.9  iterators_1.0.12   tools_3.6.1       
#&gt;  [7] digest_0.6.22      jsonlite_1.6       lattice_0.20-38   
#&gt; [10] evaluate_0.14      memoise_1.1.0      tibble_2.1.3      
#&gt; [13] gtable_0.3.0       pkgconfig_2.0.3    rlang_0.4.1       
#&gt; [16] foreach_1.4.7      Matrix_1.2-17      rstudioapi_0.10   
#&gt; [19] yaml_2.2.0         pkgdown_1.3.0.9100 xfun_0.9          
#&gt; [22] ggdendro_0.1-20    gridExtra_2.3      withr_2.1.2       
#&gt; [25] stringr_1.4.0      dplyr_0.8.3        roxygen2_7.0.0    
#&gt; [28] xml2_1.2.2         knitr_1.24         desc_1.2.0        
#&gt; [31] fs_1.3.1           glmnet_3.0         rprojroot_1.3-2   
#&gt; [34] grid_3.6.1         tidyselect_0.2.5   reticulate_1.13   
#&gt; [37] glue_1.3.1         R6_2.4.0           rmarkdown_1.15    
#&gt; [40] purrr_0.3.3        magrittr_1.5       codetools_0.2-16  
#&gt; [43] backports_1.1.5    scales_1.0.0       htmltools_0.3.6   
#&gt; [46] MASS_7.3-51.4      assertthat_0.2.1   shape_1.4.4       
#&gt; [49] colorspace_1.4-1   labeling_0.3       stringi_1.4.3     
#&gt; [52] lazyeval_0.2.2     munsell_0.5.0      crayon_1.3.4</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-and-logistic-regression-model-for-titanic-survival">Data and logistic regression model for Titanic survival</a></li>
      <li><a href="#preparing-additional-parameters">Preparing additional parameters</a></li>
      <li><a href="#calculating-aspect-importance-logistic-regression">Calculating aspect importance (logistic regression)</a></li>
      <li><a href="#calculating-aspect-importance-with-explainer">Calculating aspect importance with explainer</a></li>
      <li><a href="#random-forest-model-for-titanic-survival">Random forest model for Titanic survival</a></li>
      <li><a href="#calculating-aspect-importance-random-forest">Calculating aspect importance (random forest)</a></li>
      <li><a href="#using-lasso-in-aspect_importance-function">Using lasso in aspect_importance() function</a></li>
      <li><a href="#automated-grouping-features-into-aspects">Automated grouping features into aspects</a></li>
      <li><a href="#hierarchical-aspects-importance">Hierarchical aspects importance</a></li>
      <li><a href="#session-info">Session info</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="author">
  <p>
    Developed by Szymon Maksymiuk, Przemyslaw Biecek, Katarzyna Pekala.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
