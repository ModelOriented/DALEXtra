<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Caluculate difference in performance in models across different categories — funnel_measure • DALEXtra</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Caluculate difference in performance in models across different categories — funnel_measure" />

<meta property="og:description" content="Function funnel_measure allows users to compare two models based on their explainers. It partitions dataset on which models were builded
and creates categories according to quantiles of columns in parition data. nbins parameter determinates number of qunatiles.
For each category difference in provided measure is being calculated. Positive value of that differnece means that Champion model
has better performance in specified category, while negative value means that one of the Challengers was better. Function allows
to compare multiple Challengers at once." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
      <a class = "navbar-mi2logo" href="http://DrWhy.AI/">
    <img src = "https://github.com/ModelOriented/DrWhyTemplate/blob/master/inst/pkgdown/assets/drwhy_znak_violet_small.jpg?raw=true" alt = "MI2" height = 46 title = "MI2">
	  </a>
        <a class="navbar-brand" href="../index.html">DALEXtra</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.1.8</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/DALEXtra">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Caluculate difference in performance in models across different categories</h1>
    <small class="dont-index">Source: <a href='https://github.com/ModelOriented/DALEXtra/blob/master/R/funnel_measure.R'><code>R/funnel_measure.R</code></a></small>
    <div class="hidden name"><code>funnel_measure.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Function <code>funnel_measure</code> allows users to compare two models based on their explainers. It partitions dataset on which models were builded
and creates categories according to quantiles of columns in <code>parition data</code>. <code>nbins</code> parameter determinates number of qunatiles.
For each category difference in provided measure is being calculated. Positive value of that differnece means that Champion model
has better performance in specified category, while negative value means that one of the Challengers was better. Function allows
to compare multiple Challengers at once.</p>
    
    </div>

    <pre class="usage"><span class='fu'>funnel_measure</span>(<span class='no'>champion</span>, <span class='no'>challengers</span>,
  <span class='kw'>measure_function</span> <span class='kw'>=</span> <span class='kw pkg'>DALEX</span><span class='kw ns'>::</span><span class='no'><a href='https://rdrr.io/pkg/DALEX/man/loss_cross_entropy.html'>loss_root_mean_square</a></span>, <span class='kw'>nbins</span> <span class='kw'>=</span> <span class='fl'>5</span>,
  <span class='kw'>partition_data</span> <span class='kw'>=</span> <span class='no'>champion</span>$<span class='no'>data</span>, <span class='kw'>cutoff</span> <span class='kw'>=</span> <span class='fl'>0.01</span>,
  <span class='kw'>cutoff_name</span> <span class='kw'>=</span> <span class='st'>"Other"</span>, <span class='kw'>factor_conversion_threshold</span> <span class='kw'>=</span> <span class='fl'>7</span>,
  <span class='kw'>show_info</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>champion</th>
      <td><p>- explainer of champion model.</p></td>
    </tr>
    <tr>
      <th>challengers</th>
      <td><p>- explainer of challenger model or list of explainers.</p></td>
    </tr>
    <tr>
      <th>measure_function</th>
      <td><p>- measure function that calculates performance of model based on true observation and prediction.
Order of parameters is important and should be (y, y_hat). The measure calculated by the function
should have the property that lower score value indicates better model. By default it is RMSE.</p></td>
    </tr>
    <tr>
      <th>nbins</th>
      <td><p>- Number of qunatiles (partition points) for numeric columns. In case when more than one qunatile have the same value, there will be less partition points.</p></td>
    </tr>
    <tr>
      <th>partition_data</th>
      <td><p>- Data by which test dataset will be paritioned for computation. Can be either data.frame or character vector.
When second is passed, it has to indicate names of columns that will be extracted fromm test data.
By default full test data. If data.frame, number of rows has to be equal to number of rows in test data.</p></td>
    </tr>
    <tr>
      <th>cutoff</th>
      <td><p>- Threshold for categorical data. Entries less frequent than specified value will be merged into one category.</p></td>
    </tr>
    <tr>
      <th>cutoff_name</th>
      <td><p>- Name for new category that arised after merging entries less frequent than <code>cutoff</code></p></td>
    </tr>
    <tr>
      <th>factor_conversion_threshold</th>
      <td><p>- Numeric columns with lower number of unique values than value of this parameter will be treated as factors</p></td>
    </tr>
    <tr>
      <th>show_info</th>
      <td><p>- Logical value indicating if progress bar should be shown.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of the class <code>funnel_measure</code></p>
<p>It is a named list containing following fields:</p><ul>
<li><p><code>data</code> data.frame that consists of columns:</p><ul>
<li><p><code>Variable</code> Variable according to which partitions were made</p></li>
<li><p><code>Measure</code> Difference in measures. Positive value indicates that champion was better, while negative that challenger.</p></li>
<li><p><code>Label</code> String that defines subset of <code>Variable</code> values (partition rule).</p></li>
<li><p><code>Challenger</code> Label of challenger explainer that was used in <code>Measure</code></p></li>
</ul></li>
<li><p><code>models_info</code> data.frame containig inforamtion about models used in analysys</p></li>
</ul>

    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"mlr"</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='st'>"DALEXtra"</span>)
<span class='no'>task</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mlr</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mlr/man/RegrTask.html'>makeRegrTask</a></span>(
  <span class='kw'>id</span> <span class='kw'>=</span> <span class='st'>"R"</span>,
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>apartments</span>,
  <span class='kw'>target</span> <span class='kw'>=</span> <span class='st'>"m2.price"</span>
)
<span class='no'>learner_lm</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mlr</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mlr/man/makeLearner.html'>makeLearner</a></span>(
  <span class='st'>"regr.lm"</span>
)
<span class='no'>model_lm</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mlr</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mlr/man/train.html'>train</a></span>(<span class='no'>learner_lm</span>, <span class='no'>task</span>)
<span class='no'>explainer_lm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='explain_mlr.html'>explain_mlr</a></span>(<span class='no'>model_lm</span>, <span class='no'>apartmentsTest</span>, <span class='no'>apartmentsTest</span>$<span class='no'>m2.price</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='st'>"LM"</span>)</div><div class='output co'>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  LM 
#&gt;   -&gt; data              :  9000  rows  6  cols 
#&gt;   -&gt; target variable   :  9000  values 
#&gt;   -&gt; data              :  A column identical to the target variable `y` has been found in the `data`.  (<span style='color: #BB0000;'>WARNING</span><span>)
#&gt;   -&gt; data              :  It is highly recommended to pass `data` without the target variable column
#&gt;   -&gt; predict function  :  yhat.WrappedModel  will be used (</span><span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; predicted values  :  numerical, min =  1792.597 , mean =  3506.836 , max =  6241.447  
#&gt;   -&gt; residual function :  difference between y and yhat (</span><span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; residuals         :  numerical, min =  -257.2555 , mean =  4.687686 , max =  472.356  
#&gt; </span><span style='color: #00BB00;'>A new explainer has been created!</span><span></div><div class='input'>
<span class='no'>learner_rf</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mlr</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mlr/man/makeLearner.html'>makeLearner</a></span>(
  <span class='st'>"regr.randomForest"</span>
)
<span class='no'>model_rf</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mlr</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mlr/man/train.html'>train</a></span>(<span class='no'>learner_rf</span>, <span class='no'>task</span>)
<span class='no'>explainer_rf</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='explain_mlr.html'>explain_mlr</a></span>(<span class='no'>model_rf</span>, <span class='no'>apartmentsTest</span>, <span class='no'>apartmentsTest</span>$<span class='no'>m2.price</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='st'>"RF"</span>)</div><div class='output co'>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  RF 
#&gt;   -&gt; data              :  9000  rows  6  cols 
#&gt;   -&gt; target variable   :  9000  values 
#&gt;   -&gt; data              :  A column identical to the target variable `y` has been found in the `data`.  (</span><span style='color: #BB0000;'>WARNING</span><span>)
#&gt;   -&gt; data              :  It is highly recommended to pass `data` without the target variable column
#&gt;   -&gt; predict function  :  yhat.WrappedModel  will be used (</span><span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; predicted values  :  numerical, min =  1990.354 , mean =  3507.247 , max =  5832.487  
#&gt;   -&gt; residual function :  difference between y and yhat (</span><span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; residuals         :  numerical, min =  -717.3285 , mean =  4.276517 , max =  1255.057  
#&gt; </span><span style='color: #00BB00;'>A new explainer has been created!</span><span></div><div class='input'>
<span class='no'>learner_gbm</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mlr</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mlr/man/makeLearner.html'>makeLearner</a></span>(
  <span class='st'>"regr.gbm"</span>
)
<span class='no'>model_gbm</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>mlr</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/pkg/mlr/man/train.html'>train</a></span>(<span class='no'>learner_gbm</span>, <span class='no'>task</span>)
<span class='no'>explainer_gbm</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='explain_mlr.html'>explain_mlr</a></span>(<span class='no'>model_gbm</span>, <span class='no'>apartmentsTest</span>, <span class='no'>apartmentsTest</span>$<span class='no'>m2.price</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='st'>"GBM"</span>)</div><div class='output co'>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  GBM 
#&gt;   -&gt; data              :  9000  rows  6  cols 
#&gt;   -&gt; target variable   :  9000  values 
#&gt;   -&gt; data              :  A column identical to the target variable `y` has been found in the `data`.  (</span><span style='color: #BB0000;'>WARNING</span><span>)
#&gt;   -&gt; data              :  It is highly recommended to pass `data` without the target variable column
#&gt;   -&gt; predict function  :  yhat.WrappedModel  will be used (</span><span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; predicted values  :  numerical, min =  2110.295 , mean =  3503.859 , max =  6044.313  
#&gt;   -&gt; residual function :  difference between y and yhat (</span><span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; residuals         :  numerical, min =  -507.2952 , mean =  7.664081 , max =  744.2742  
#&gt; </span><span style='color: #00BB00;'>A new explainer has been created!</span><span></div><div class='input'>

<span class='no'>plot_data</span> <span class='kw'>&lt;-</span> <span class='fu'>funnel_measure</span>(<span class='no'>explainer_lm</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='no'>explainer_rf</span>, <span class='no'>explainer_gbm</span>),
                            <span class='kw'>nbins</span> <span class='kw'>=</span> <span class='fl'>5</span>, <span class='kw'>measure_function</span> <span class='kw'>=</span> <span class='kw pkg'>DALEX</span><span class='kw ns'>::</span><span class='no'><a href='https://rdrr.io/pkg/DALEX/man/loss_cross_entropy.html'>loss_root_mean_square</a></span>)</div><div class='output co'>#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |============                                                          |  17%  |                                                                              |=======================                                               |  33%  |                                                                              |===================================                                   |  50%  |                                                                              |===============================================                       |  67%  |                                                                              |==========================================================            |  83%  |                                                                              |======================================================================| 100%</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/plot.html'>plot</a></span>(<span class='no'>plot_data</span>)</div><div class='img'><img src='funnel_measure-1.png' alt='' width='700' height='433' /></div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="author">
  <p>
    Developed by Szymon Maksymiuk, Przemyslaw Biecek.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


