<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Wrapper for Python Scikit-Learn Models — explain_scikitlearn • DALEXtra</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class = "navbar-mi2logo" href="http://mi2.mini.pw.edu.pl/">
        <img src = "https://github.com/mi2-warsaw/MI2template/blob/master/inst/pkgdown/assets/MI2logo.jpg?raw=true" alt = "MI2" height = 46 title = "MI2">
	  </a>
      <a class="navbar-brand navbar-mi2" href="../index.html">Wrapper for Python Scikit-Learn Models</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Wrapper for Python Scikit-Learn Models</h1>
    </div>

    
    <p>scikit-learn models may be loaded into R environment like any other Python object. This function helps to inspect performance of Python model
and compare it with other models, using R tools like DALEX. This function creates an object that is easy accessible R version of scikit-learn model
exported from Python via pickle file.</p>
    

    <pre class="usage"><span class='fu'>explain_scikitlearn</span>(<span class='no'>path</span>, <span class='kw'>yml</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>condaenv</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>env</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>predict_function</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>residual_function</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>precalculate</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>path</th>
      <td><p>a path to the pickle file. Can be used without other arguments if you are sure that active Python version match pickle version.</p></td>
    </tr>
    <tr>
      <th>yml</th>
      <td><p>a path to the yml file. Conda virtual env will be recreated from this file. If OS is Windows conda has to be added to the PATH first</p></td>
    </tr>
    <tr>
      <th>condaenv</th>
      <td><p>If yml param is provided, a path to the main conda folder. If yml is null, a name of existing conda environment.</p></td>
    </tr>
    <tr>
      <th>env</th>
      <td><p>A path to python virtual environment.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>test data set that will be passed to explainer.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>vector that will be passed to explainer.</p></td>
    </tr>
    <tr>
      <th>predict_function</th>
      <td><p>predict function that will be passed into explainer. If NULL, default will be used.</p></td>
    </tr>
    <tr>
      <th>residual_function</th>
      <td><p>residual function that will be passed into explainer. If NULL, default will be used.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other parameters</p></td>
    </tr>
    <tr>
      <th>label</th>
      <td><p>label that will be passed into explainer. If NULL, default will be used.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>bool that will be passed into explainer. If NULL, default will be used.</p></td>
    </tr>
    <tr>
      <th>precalculate</th>
      <td><p>if TRUE (default) then 'predicted_values' and 'residuals' are calculated when explainer is created. This will happenn also if 'verbose' is TRUE.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of the class 'explainer'. Possible extraction of object 'scikitlearn_model' via explainer$model</p>
<p>scikitlearn_model is a list with following fields:</p>
<ul>
<li><p><code>model</code> it is original model received vie reticiulate function. Use it for computations.</p></li>
<li><p><code>predict_function</code> predict function extracted from original model. It is adjusted to DALEX demands and therfore fully compatibile.</p></li>
<li><p><code>type</code> type model, classification or regression</p></li>
<li><p><code>params</code> object of class `scikitlearn_set` which in fact is list that consist of parameters of our model.</p></li>
<li><p><code>label</code> name of model</p></li>
</ul>

<p><b>Example of Python code</b><br /></p>
<p>from pandas import DataFrame, read_csv <br />
import pandas as pd<br />
import pickle<br />
import sklearn.ensemble<br />
model = sklearn.ensemble.GradientBoostingClassifier() <br />
model = model.fit(titanic_train_X, titanic_train_Y)<br />
pickle.dump(model, open("gbm.pkl", "wb"), protocol = 2)<br />
<br />
<br />
In order to export environment into .yml, activating virtual env via <code>activate name_of_the_env</code> and execution of the following shell command is necessary <br />
<code>conda env export &gt; environment.yml</code><br />
<br /></p>
<p><b>Errors use case</b><br />
Here is shortened version of solution for specific errors <br />
<br />
<b>There already exists environment with a name specified by given .yml file</b><br />
You have two ways of solving that issue. Both connected with anaconda prompt. First is removing conda env with command: <br />
<code>conda env remove --name myenv</code><br />
And execute function once again. Second is updating env via: <br />
<code>conda env create -f environment.yml</code><br />
<br />
<b>Conda cannot find specified packages at channels you have provided.</b><br />
That error may be casued by a lot of things. Of of those is that specified version is too old to be avaialble from offcial conda repo.
Edit Your .yml file and add link to proper repository at channels section.<br />
<br />
Issue may be also connected with the platform. If model was created on the platform with different OS yo may need to remove specific version from .yml file.<br />
<code>- numpy=1.16.4=py36h19fb1c0_0</code><br />
<code>- numpy-base=1.16.4=py36hc3f5095_0</code><br />
In the example above You have to remove <code>=py36h19fb1c0_0</code> and <code>=py36hc3f5095_0</code> <br />
If some packages are not availbe for anaconda at all, use pip statement<br />
<br />
If .yml file seems not to work, virtual env can be created manually using anaconda promt. <br />
<code>conda create -n name_of_env python=3.4</code> <br />
<code>conda install -n name_of_env name_of_package=0.20</code> <br /></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw pkg'>reticulate</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/reticulate/topics/use_python'>use_condaenv</a></span>(<span class='st'>"myenv"</span>)
<span class='no'>have_sklearn</span> <span class='kw'>&lt;-</span> <span class='kw pkg'>reticulate</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/reticulate/topics/py_module_available'>py_module_available</a></span>(<span class='st'>"sklearn.ensemble"</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='st'>"DALEXtra"</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='st'>"DALEX"</span>)
<span class='kw'>if</span>(<span class='st'>"myenv"</span> <span class='kw'>%in%</span> <span class='kw pkg'>reticulate</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/reticulate/topics/conda-tools'>conda_list</a></span>()$<span class='no'>name</span>){
<span class='kw'>if</span>(<span class='no'>have_sklearn</span>) {
   <span class='co'># Explainer build (Keep in mind that 18th column is target)</span>
   <span class='no'>titanic_test</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/read.table'>read.csv</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"extdata"</span>, <span class='st'>"titanic_test.csv"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"DALEXtra"</span>))
   <span class='co'># Keep in mind that when pickle is being built and loaded,</span>
   <span class='co'># not only Python version but libraries versions has to match aswell</span>
   <span class='no'>explainer</span> <span class='kw'>&lt;-</span> <span class='fu'>explain_scikitlearn</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"extdata"</span>, <span class='st'>"scikitlearn.pkl"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"DALEXtra"</span>),
   <span class='kw'>condaenv</span> <span class='kw'>=</span> <span class='st'>"myenv"</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>titanic_test</span>[,<span class='fl'>1</span>:<span class='fl'>17</span>], <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>titanic_test</span>$<span class='no'>survived</span>)
   <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/print'>print</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/DALEX/topics/model_performance'>model_performance</a></span>(<span class='no'>explainer</span>))

   <span class='co'># Predictions with newdata</span>
   <span class='no'>explainer</span>$<span class='no'>model</span>$<span class='fu'>predict_function</span>(<span class='no'>explainer</span>$<span class='no'>model</span>, <span class='no'>titanic_test</span>[<span class='fl'>1</span>:<span class='fl'>10</span>,<span class='fl'>1</span>:<span class='fl'>17</span>])

} <span class='kw'>else</span> {
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/print'>print</a></span>(<span class='st'>'Python testing environment is required.'</span>)
}
} <span class='kw'>else</span>{
  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/print'>print</a></span>(<span class='st'>"myenv does not exists, use yml argument"</span>)

}</div><div class='output co'>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  GradientBoostingClassifier 
#&gt;   -&gt; data              :  524  rows  17  cols 
#&gt;   -&gt; target variable   :  524  values 
#&gt;   -&gt; predict function  :  scikitlearn_model$predict_function 
#&gt;   -&gt; predicted values  :  numerical, min =  0.02086126 , mean =  0.288584 , max =  0.9119996  
#&gt;   -&gt; residual function :  difference between y and yhat (<span style='color: #BBBB00;'>default</span><span>)
#&gt;   -&gt; residuals         :  numerical, min =  -0.8669431 , mean =  0.02248468 , max =  0.9791387  
#&gt; </span><span style='color: #00BB00;'>A new explainer has been created!</span><span>
#&gt;          0%         10%         20%         30%         40%         50% 
#&gt; -0.97913874 -0.73232601 -0.28554500 -0.12647147  0.07719668  0.13219474 
#&gt;         60%         70%         80%         90%        100% 
#&gt;  0.15734697  0.17403135  0.23221115  0.28252542  0.86694306 </div><div class='output co'>#&gt;  [1] 0.3565896 0.1321947 0.7638813 0.1037486 0.1265221 0.2949228 0.1421281
#&gt;  [8] 0.1421281 0.4154695 0.1321947</div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Szymon Maksymiuk</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Szymon Maksymiuk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>

